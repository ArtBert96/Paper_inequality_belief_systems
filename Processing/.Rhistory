##plot
plot(LCA_NL_6)
#comment for LCA6
#1:
#2:
#3:
#4:
#5:
#6:
#7:
#add predclass to NL and merge
NL_CCA$pred = LCA_NL_6$predclass
mijs_nl$mem = CCA_group_NL$membership
mijs_nl$pred = LCA_NL_6$predclass
#filter out second CCA class
NL_CCA = NL_CCA %>%
filter(mem != 2)
#filter useless v
NL_CCA1_EGA = NL_CCA %>%
filter(mem == 1) %>%
select(perc_income:ib_sex)
NL_CCA2_EGA = NL_CCA %>%
filter(mem == 3) %>%
select(perc_income:ib_sex)
NL_ega_CCA1 <- EGA(data=NL_CCA1_EGA,  model = "TMFG",
plot.EGA = TRUE)
NL_ega_CCA2 <- EGA(data=NL_CCA2_EGA,  model = "TMFG",
plot.EGA = TRUE)
#filter useless v
NL_LCA1_EGA = NL_CCA %>%
filter(pred == 1) %>%
select(perc_income:ib_sex)
NL_LCA2_EGA = NL_CCA %>%
filter(pred == 2) %>%
select(perc_income:ib_sex)
NL_LCA3_EGA = NL_CCA %>%
filter(pred == 3) %>%
select(perc_income:ib_sex)
NL_LCA4_EGA = NL_CCA %>%
filter(pred == 4) %>%
select(perc_income:ib_sex)
NL_LCA5_EGA = NL_CCA %>%
filter(pred == 5) %>%
select(perc_income:ib_sex)
NL_LCA6_EGA = NL_CCA %>%
filter(pred == 6) %>%
select(perc_income:ib_sex)
ega_LCA_NL_1 <- EGA(data=NL_LCA1_EGA,  model = "TMFG",
plot.EGA = TRUE)
ega_LCA_NL_2 <- EGA(data=NL_LCA2_EGA,  model = "TMFG",
plot.EGA = TRUE)
ega_LCA_NL_3 <- EGA(data=NL_LCA3_EGA,  model = "TMFG",
plot.EGA = TRUE)
ega_LCA_NL_4 <- EGA(data=NL_LCA4_EGA,  model = "TMFG",
plot.EGA = TRUE)
ega_LCA_NL_5 <- EGA(data=NL_LCA5_EGA,  model = "TMFG", # da problemi
plot.EGA = TRUE)
ega_LCA_NL_6 <- EGA(data=NL_LCA6_EGA,  model = "TMFG",
plot.EGA = TRUE)
mijs_us = mijs_us %>%
rename( CCA = mem,
LCA = pred) %>%
filter(CCA != 2)
#cross tab
mijs_us %>%
select(CCA, att_redist) %>%
flat_table(margin = "row", digits = 1)
#graph
mijs_us_n = nrow(mijs_us)
crosstab_US = mijs_us %>%
group_by(CCA) %>%
mutate(n_cca = n()) %>%
group_by(CCA, att_redist) %>%
summarise(count = n(),
pct = count / n_cca) %>%
slice(1) %>%
ggplot(aes(y=pct, x=att_redist)) +
geom_col() +
facet_wrap(~CCA) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = 1:7) +
labs(x="Attitude towards redistribution", y="Percentage")
ggsave(filename = here("Output", "graph_tab_US.jpg"), plot =  crosstab_US)
#regression
mijs_us = mijs_us %>%
mutate(CCA = as.factor(paste0(CCA)),
hhincome = as.factor(paste0(hhincome)))
m1_US = lm(att_redist ~ CCA, data = mijs_us)
m2_US = lm(att_redist ~ CCA + age + sex + race + education + working + politics +
hhincome + immigrant + marital + religion, data = mijs_us)
m3_US = lm(att_redist ~ age + sex + race + education + working + politics +
hhincome + immigrant + marital + religion, data = mijs_us)
#xtable
screenreg(list(m1_US, m2_US, m3_US), stars = c(0.01,0.05,0.1))
mijs_nl = mijs_nl %>%
rename( CCA = mem,
LCA = pred) %>%
filter(CCA != 2)
#cross tab
mijs_nl %>%
select(CCA, att_redist) %>%
flat_table(margin = "row", digits = 1)
#graph
mijs_nl_n = nrow(mijs_nl)
crosstab_NL = mijs_nl %>%
group_by(CCA) %>%
mutate(n_cca = n()) %>%
group_by(CCA, att_redist) %>%
summarise(count = n(),
pct = count / n_cca) %>%
slice(1) %>%
ggplot(aes(y=pct, x=att_redist)) +
geom_col() +
facet_wrap(~CCA) +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
scale_x_continuous(breaks = 1:7) +
labs(x="Attitude towards redistribution", y="Percentage")
ggsave(filename = here("Output", "graph_tab_NL.jpg"), plot =  crosstab_NL)
#regression
mijs_nl = mijs_nl %>%
mutate(CCA = as.factor(paste0(CCA)),
hhincome = as.factor(paste0(hhincome)))
m1_NL = lm(att_redist ~ CCA, data = mijs_nl)
m2_NL = lm(att_redist ~ CCA + age + sex + race + education + working + politics +
hhincome + immigrant + marital + religion, data = mijs_nl)
m3_NL = lm(att_redist ~ age + sex + race + education + working + politics +
hhincome + immigrant + marital + religion, data = mijs_nl)
#xtable
screenreg(list(m1_NL, m2_NL, m3_NL), stars = c(0.01,0.05,0.1))
save(mijs_us, US_ega_CCA1, US_ega_CCA2, LCA_US_7,
mijs_nl, NL_ega_CCA1, NL_ega_CCA2, LCA_NL_6,
file = here("Output",  "230314 - Output.RData"))
US_plot_CCA_1 = plot(CCA_group_US, 1)
# plot(CCA_group_US, 2)
US_plot_CCA_2 = plot(CCA_group_US, 3)
NL_plot_CCA_1 = plot(CCA_group_NL, 1)
# plot(CCA_group_NL, 2)
NL_plot_CCA_2 = plot(CCA_group_NL, 3)
save(mijs_us, US_ega_CCA1, US_ega_CCA2, LCA_US_7, US_plot_CCA_1, US_plot_CCA_1,
mijs_nl, NL_ega_CCA1, NL_ega_CCA2, LCA_NL_6, NL_plot_CCA_1, NL_plot_CCA_2,
file = here("Output",  "230314 - Output.RData"))
save(mijs_us, US_ega_CCA1, US_ega_CCA2, LCA_US_7, US_plot_CCA_1, US_plot_CCA_2,
mijs_nl, NL_ega_CCA1, NL_ega_CCA2, LCA_NL_6, NL_plot_CCA_1, NL_plot_CCA_2,
file = here("Output",  "230314 - Output.RData"))
US_plot_CCA_2
US_plot_CCA_1 = plot(CCA_group_US, 1)
US_plot_CCA_1
CCA_group_NL
CCA_group_US
NL_plot_CCA_1 = plot(CCA_group_NL, 1)
NL_plot_CCA_2 = plot(CCA_group_NL, 3)
plot(CCA_group_NL, 1)
save(mijs_us, US_ega_CCA1, US_ega_CCA2, LCA_US_7, CCA_group_US,
mijs_nl, NL_ega_CCA1, NL_ega_CCA2, LCA_NL_6, CCA_group_NL,
file = here("Output",  "230314 - Output.RData"))
pdf(file = '../Output/7NL.pdf',
height = 9, width = 12)
plot(LCA_US_7)
dev.off()
pdf(file = '../Output/7US.pdf',
height = 9, width = 12)
plot(LCA_US_7)
dev.off()
##plot
pdf(file = '../Output/6NL.pdf',
height = 9, width = 12)
plot(LCA_NL_6)
dev.off()
??get_label
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
#Libraries
library(pacman)
p_load(tidyverse, janitor, here, haven, labelled, sjmisc, skimr,
stargazer, purr, conflicted, biclust, corclass, poLCA)
#Packages conflicts
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")
options(max.print=999999)
options(scipen=999999)
#Load database
mijs = read_dta(here("Input", "data_full_stata.dta"))  %>%
clean_names()
#Select variables
mijs_final = mijs %>%
select(nomem_encr, survey, country, treatment,
age, sex, race, education, working, politics, pol5,
hhincome, immigrant, marital, religion, ladder_present,
ineq_post1, ineq_post2, ineq_post3, ineq_post4,
ineq_pre1, ineq_pre2, ineq_pre3,
belief_1:belief_9,
ineq_post5, ineq_post6
)
mijs_final = mijs_final %>%
rename(ib_weafam = belief_1,
ib_edupar = belief_2,
ib_edu = belief_3,
ib_work = belief_4,
ib_people = belief_5,
ib_migra = belief_7,
ib_race = belief_6,
ib_relig = belief_8,
ib_sex = belief_9,
perc_income = ineq_post1,
perc_wealth = ineq_post2,
perc_poor = ineq_post3,
perc_black = ineq_post4,
bel_merit = ineq_pre1,
bel_diversity = ineq_pre2,
bel_equality = ineq_pre3,
att_redist = ineq_post5,
att_discrim = ineq_post6) %>%
select(nomem_encr, survey, country, treatment,
age, sex, race, education, working, politics, pol5,
hhincome, immigrant, marital, religion, ladder_present,
#perceived_2_1, perceived_3_1,
starts_with("perc_"),
starts_with("bel_"),
starts_with("ib_"),
starts_with("att_"))
#Check variables
mijs_final1 = mijs_final %>%
select(-c(nomem_encr))
frq(mijs_final$perc_pay_gap)
#Filter US
mijs_us = mijs_final %>%
filter(country==1) %>%
na.omit()
#Filter NL
mijs_nl = mijs_final %>%
filter(country==2) %>%
na.omit()
#Databases
#US
#Complete
mijs_us
#Inequality beliefs
mijs_us_ib = mijs_us %>%
select(perc_income:ib_sex)
#Save
save(mijs_us, mijs_us_ib,
file = here("Output",  "230313 - Mijs_US_Databases.RData"))
#NL
#Complete
mijs_nl
#Inequality beliefs
mijs_nl_ib = mijs_nl %>%
select(perc_income:ib_sex)
#Save
save(mijs_nl, mijs_nl_ib,
file = here("Output",  "230313 - Mijs_NL_Databases.RData"))
#Listwise
# mijs_final1 = mijs_final %>%
#   na.omit()
#Variables
#Info
#nomem_encr, survey, country, treatment
#Controls
#age, sex, race, education, working, politics, pol5, hhincome, immigrant, marital, religion
#ladder_present
#Perceptions
#ineq_post1, ineq_post2, ineq_post3, ineq_post4
#perceived_2_1, perceived_3_1
#Beliefs
#ineq_pre1, ineq_pre2, ineq_pre3
#belief_1:belief_9
#Attitudes
#ineq_post5, ineq_post6
frq(mijs_us, treatment)
mijs_us0 = mijs_us %>%
filter(treatment==0) %>%
select(-c(nomem_encr:treatment))
mijs_us1 = mijs_us %>%
filter(treatment==1) %>%
select(-c(nomem_encr:treatment))
mijs_us2 = mijs_us %>%
filter(treatment==2) %>%
select(-c(nomem_encr:treatment))
mijs_us3 = mijs_us %>%
filter(treatment==3) %>%
select(-c(nomem_encr:treatment))
mijs_nl0 = mijs_nl %>%
filter(treatment==0) %>%
select(-c(nomem_encr:treatment))
mijs_nl1 = mijs_nl %>%
filter(treatment==1) %>%
select(-c(nomem_encr:treatment))
mijs_nl2 = mijs_nl %>%
filter(treatment==2) %>%
select(-c(nomem_encr:treatment))
# mijs_nl3 = mijs_nl %>%
#   filter(treatment==3)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_us0), function(i){
t.test(mijs_us0[[i]], mijs_us1[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_us0))
mult_test = 0.05/nrow(pvalues)
pvalues_us01 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_us0), function(i){
t.test(mijs_us0[[i]], mijs_us2[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_us0))
mult_test = 0.05/nrow(pvalues)
pvalues_us02 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_us0), function(i){
t.test(mijs_us0[[i]], mijs_us3[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_us0))
mult_test = 0.05/nrow(pvalues)
pvalues_us03 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_us1), function(i){
t.test(mijs_us1[[i]], mijs_us2[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_us1))
mult_test = 0.05/nrow(pvalues)
pvalues_us12 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_us2), function(i){
t.test(mijs_us2[[i]], mijs_us3[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_us2))
mult_test = 0.05/nrow(pvalues)
pvalues_us23 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_us1), function(i){
t.test(mijs_us1[[i]], mijs_us3[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_us1))
mult_test = 0.05/nrow(pvalues)
pvalues_us13 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
pvalues_us01
pvalues_us02
pvalues_us03
pvalues_us12
pvalues_us13
pvalues_us23
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_nl0), function(i){
t.test(mijs_nl0[[i]], mijs_nl1[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_nl0))
mult_test = 0.05/nrow(pvalues)
pvalues_nl01 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_nl0), function(i){
t.test(mijs_nl0[[i]], mijs_nl2[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_nl0))
mult_test = 0.05/nrow(pvalues)
pvalues_nl02 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
#loop each V and run t.test
tests_list <- lapply(seq_along(mijs_nl1), function(i){
t.test(mijs_nl1[[i]], mijs_nl2[[i]])
})
means = sapply(tests_list, '[[', 'estimate')
dif_mean = means[1,] - means[2,]
pvalues = as.data.frame(sapply(tests_list, '[[', 'p.value'))
#print true when the means differ
pvalues = pvalues %>%
rename(pvalues = "sapply(tests_list, \"[[\", \"p.value\")") %>%
bind_cols(names(mijs_nl1))
mult_test = 0.05/nrow(pvalues)
pvalues_nl12 = pvalues %>%
rename(variable = "...2")  %>%
bind_cols(dif_mean) %>%
filter(pvalues<mult_test) %>%
rename(dif_mean = "...3") %>%
select(variable, dif_mean, pvalues)
pvalues_nl01
pvalues_nl02
pvalues_nl12
#US
mijs_us_skim  = mijs_us %>%
mutate_if(is.character, as.numeric) %>%
mutate_if(is.factor, as.numeric) %>%
as.data.frame() %>%
stargazer(type = "text")
#NL
mijs_nl_skim  = mijs_nl %>%
mutate_if(is.character, as.numeric) %>%
mutate_if(is.factor, as.numeric) %>%
as.data.frame() %>%
stargazer(type = "text")
??get_label
p_load(tidyverse, janitor, here, haven, labelled, sjmisc, skimr,
stargazer, purr, conflicted, biclust, corclass, poLCA, sjlabelled)
labels_data = as.data.frame(get_label(mijs_us)) %>%
rownames_to_column(var = "variable") %>%
colnames<-(c("variable", "label"))
#Libraries
library(pacman)
p_load(tidyverse, janitor, here, haven, labelled, sjmisc, skimr,
stargazer, purr, conflicted, biclust, corclass, poLCA, sjlabelled)
View(mijs_us)
View(mijs_us)
conflict_prefer("get_label", "sjlabelled")
save(mijs_us, US_ega_CCA1, US_ega_CCA2, LCA_US_7, CCA_group_US,
mijs_nl, NL_ega_CCA1, NL_ega_CCA2, LCA_NL_6, CCA_group_NL,
file = here("Output",  "230314 - Output.RData"))
#Libraries
library(pacman)
p_load(tidyverse, janitor, here, haven, labelled, sjmisc, skimr,
stargazer, purr, conflicted, biclust, corclass, poLCA, sjlabelled)
conflict_prefer("get_label", "sjlabelled")
labels_data = as.data.frame(get_label(mijs_us)) %>%
rownames_to_column(var = "variable") %>%
colnames<-(c("variable", "label"))
??get_label
#Libraries
library(pacman)
p_load(tidyverse, janitor, here, haven, labelled, sjmisc, skimr,
stargazer, purr, conflicted, biclust, corclass, poLCA, sjlabelled)
conflicted::conflicts_prefer(sjmisc::to_character)
conflicted::conflicts_prefer(sjmisc::to_character)
labels_data = as.data.frame(get_label(mijs_us)) %>%
rownames_to_column(var = "variable") %>%
colnames<-(c("variable", "label"))
labels_data = as.data.frame(sjlabelled::get_label(mijs_us)) %>%
rownames_to_column(var = "variable") %>%
colnames<-(c("variable", "label"))
